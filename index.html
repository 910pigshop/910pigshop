<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>910è±¬å¼ä¼šç¤¾</title>
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="910è±¬å¼">
    <link rel="apple-touch-icon" href="https://via.placeholder.com/192/007AFF/FFFFFF?text=910">
    
    <style>
        :root { --bg: #f8f9fa; --card: #ffffff; --blue: #007aff; --gray: #8e8e93; }
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; background: var(--bg); margin: 0; padding-bottom: 100px; -webkit-tap-highlight-color: transparent; }
        .header { text-align: center; padding: 20px 0; font-size: 24px; font-weight: 900; background: var(--card); }
        .tabs { display: flex; justify-content: space-around; position: fixed; bottom: 0; width: 100%; background: var(--card); padding: 15px 0 35px; border-top: 1px solid #ddd; z-index: 100; }
        .tab-item { text-align: center; color: var(--gray); font-size: 12px; cursor: pointer; flex: 1; }
        .tab-item.active { color: var(--blue); }
        .tab-icon { font-size: 20px; display: block; margin-bottom: 4px; }
        
        .container { padding: 15px; display: none; }
        .container.active { display: block; }
        
        /* ç›¸å¡æ¨£å¼ */
        .card-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
        .photo-card { background: var(--card); padding: 12px; border-radius: 18px; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
        .card-name { font-weight: 800; font-size: 16px; margin-bottom: 8px; white-space: nowrap; overflow: hidden; }
        .card-controls { display: flex; align-items: center; justify-content: space-between; }
        .price-tag { color: var(--blue); font-weight: bold; }
        .stepper { display: flex; align-items: center; gap: 5px; }
        .btn-step { background: none; border: none; color: var(--blue); font-size: 24px; cursor: pointer; padding: 0; }
        .btn-step.minus { color: var(--gray); }
        .count-input { width: 45px; text-align: center; border: none; background: #f0f0f0; border-radius: 5px; padding: 4px 0; font-weight: bold; font-size: 16px; }

        /* è¨­å®šé æ¨£å¼ */
        .settings-item { background: var(--card); padding: 15px; border-radius: 12px; margin-bottom: 10px; display: flex; justify-content: space-between; align-items: center; }
        .settings-input { border: 1px solid #ddd; border-radius: 5px; padding: 8px; width: 80px; text-align: right; }
        .card-edit-box { background: var(--card); padding: 15px; border-radius: 12px; margin-bottom: 10px; }
        .full-input { width: 100%; border: 1px solid #ddd; padding: 8px; border-radius: 5px; margin-bottom: 8px; font-weight: bold; box-sizing: border-box; }

        /* å ±åƒ¹çµæœ */
        #report-box { background: #fff; border-radius: 20px; padding: 15px; margin-top: 20px; }
        #report-text { width: 100%; height: 150px; background: #f0f0f0; border: none; border-radius: 10px; padding: 10px; box-sizing: border-box; font-family: monospace; }
        .btn-main { background: var(--blue); color: #white; border: none; width: 100%; padding: 15px; border-radius: 15px; font-weight: bold; color: #fff; font-size: 18px; margin-top: 15px; }
        .profit-text { text-align: center; font-weight: bold; color: #28a745; margin: 10px 0; }
    </style>
</head>
<body onclick="hideKeyboard(event)">
    <div class="header">910è±¬å¼ä¼šç¤¾</div>

    <div id="tab0" class="container active">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
            <h2 style="margin:0">ğŸ“¸ ç›¸å¡å ±åƒ¹</h2>
            <button onclick="resetCounts()" style="color:var(--gray); border:none; background:none;">é‡ç½®å¼µæ•¸</button>
        </div>
        <div class="card-grid" id="photo-card-list"></div>
        <button class="btn-main" onclick="generateReport()">ğŸ” ç”Ÿæˆå ±åƒ¹å–®</button>
        <div id="report-box" style="display:none">
            <textarea id="report-text" readonly></textarea>
            <div id="card-profit" class="profit-text"></div>
            <button class="btn-main" style="background:#000" onclick="copyReport()">é»æ“Šè¤‡è£½å ±åƒ¹å–®</button>
        </div>
    </div>

    <div id="tab1" class="container">
        <h2>ğŸ“¦ å•†å“å ±åƒ¹</h2>
        <div style="background:#fff; padding:30px; border-radius:30px; margin-bottom:20px;">
            <div style="color:var(--gray)">Â¥ è«‹è¼¸å…¥é‡‘é¡</div>
            <input type="number" id="jpy-input" style="font-size:55px; width:100%; border:none; outline:none;" placeholder="0" oninput="calcProduct()">
        </div>
        <div id="product-results"></div>
    </div>

    <div id="tab2" class="container">
        <h2>âš™ï¸ ç³»çµ±è¨­å®š</h2>
        <div id="settings-fields"></div>
        <hr>
        <h3>ç›¸å¡åç¨±èˆ‡åƒ¹æ ¼å®šç¾©</h3>
        <div id="card-settings-list"></div>
    </div>

    <div class="tabs">
        <div class="tab-item active" onclick="showTab(0)"><span class="tab-icon">ğŸ–¼ï¸</span>ç›¸å¡</div>
        <div class="tab-item" onclick="showTab(1)"><span class="tab-icon">ğŸ“¦</span>å ±åƒ¹</div>
        <div class="tab-item" onclick="showTab(2)"><span class="tab-icon">âš™ï¸</span>è¨­å®š</div>
    </div>

    <script>
        // åˆå§‹åŒ–è³‡æ–™
        let settings = JSON.parse(localStorage.getItem('910Settings')) || {
            realRate: 0.20, pubRate: 0.22, pct1: 17.5, pct2: 15, pct3: 20,
            cards: [
                { name: "Lawson Låˆ¤", jpy: 30, twd: 15, count: 0 },
                { name: "Lawson 2Låˆ¤", jpy: 80, twd: 25, count: 0 },
                { name: "7-11 Låˆ¤", jpy: 40, twd: 18, count: 0 },
                { name: "7-11 2Låˆ¤", jpy: 100, twd: 33, count: 0 },
                { name: "ç›¸å¡ E", jpy: 0, twd: 0, count: 0 },
                { name: "ç›¸å¡ F", jpy: 0, twd: 0, count: 0 },
                { name: "ç›¸å¡ G", jpy: 0, twd: 0, count: 0 },
                { name: "ç›¸å¡ H", jpy: 0, twd: 0, count: 0 },
                { name: "ç›¸å¡ I", jpy: 0, twd: 0, count: 0 },
                { name: "ç›¸å¡ J", jpy: 0, twd: 0, count: 0 },
                { name: "ç›¸å¡ K", jpy: 0, twd: 0, count: 0 },
                { name: "ç›¸å¡ L", jpy: 0, twd: 0, count: 0 }
            ]
        };

        function saveData() { localStorage.setItem('910Settings', JSON.stringify(settings)); renderAll(); }

        function renderAll() {
            // æ¸²æŸ“ç›¸å¡å ±åƒ¹é 
            const list = document.getElementById('photo-card-list');
            list.innerHTML = settings.cards.map((c, i) => `
                <div class="photo-card">
                    <div class="card-name">${c.name}</div>
                    <div class="card-controls">
                        <span class="price-tag">$${c.twd}</span>
                        <div class="stepper">
                            <button class="btn-step minus" onclick="updateCount(${i},-1)">âŠ–</button>
                            <input type="number" class="count-input" value="${c.count}" onchange="setCount(${i}, this.value)">
                            <button class="btn-step" onclick="updateCount(${i},1)">âŠ•</button>
                        </div>
                    </div>
                </div>
            `).join('');

            // æ¸²æŸ“è¨­å®šé  - åŒ¯ç‡
            const sFields = document.getElementById('settings-fields');
            sFields.innerHTML = `
                <div class="settings-item"><span>æˆæœ¬åŒ¯ç‡</span><input class="settings-input" type="number" step="0.01" value="${settings.realRate}" onchange="settings.realRate=this.value;saveData()"></div>
                <div class="settings-item"><span>å ±åƒ¹åŒ¯ç‡</span><input class="settings-input" type="number" step="0.01" value="${settings.pubRate}" onchange="settings.pubRate=this.value;saveData()"></div>
                <div class="settings-item"><span>äºŒæ‰‹åˆ©æ½¤%</span><input class="settings-input" type="number" value="${settings.pct1}" onchange="settings.pct1=this.value;saveData()"></div>
                <div class="settings-item"><span>é€šè²©åˆ©æ½¤%</span><input class="settings-input" type="number" value="${settings.pct2}" onchange="settings.pct2=this.value;saveData()"></div>
                <div class="settings-item"><span>ç¾åœ°åˆ©æ½¤%</span><input class="settings-input" type="number" value="${settings.pct3}" onchange="settings.pct3=this.value;saveData()"></div>
            `;

            // æ¸²æŸ“è¨­å®šé  - ç›¸å¡ç·¨è¼¯
            const cEdit = document.getElementById('card-settings-list');
            cEdit.innerHTML = settings.cards.map((c, i) => `
                <div class="card-edit-box">
                    <input class="full-input" value="${c.name}" onchange="settings.cards[${i}].name=this.value;saveData()">
                    <div style="display:flex; gap:10px; font-size:12px">
                        æˆæœ¬(æ—¥): <input type="number" class="settings-input" value="${c.jpy}" onchange="settings.cards[${i}].jpy=this.value;saveData()">
                        å ±åƒ¹(å°): <input type="number" class="settings-input" value="${c.twd}" onchange="settings.cards[${i}].twd=this.value;saveData()">
                    </div>
                </div>
            `).join('');
        }

        // é‚è¼¯å‡½æ•¸
        function updateCount(i, delta) { settings.cards[i].count = Math.max(0, settings.cards[i].count + delta); saveData(); }
        function setCount(i, val) { settings.cards[i].count = Math.max(0, parseInt(val) || 0); saveData(); }
        function resetCounts() { settings.cards.forEach(c => c.count = 0); document.getElementById('report-box').style.display='none'; saveData(); }

        function showTab(idx) {
            document.querySelectorAll('.container').forEach(c => c.classList.remove('active'));
            document.querySelectorAll('.tab-item').forEach(t => t.classList.remove('active'));
            document.getElementById('tab' + idx).classList.add('active');
            document.querySelectorAll('.tab-item')[idx].classList.add('active');
        }

        function generateReport() {
            const actives = settings.cards.filter(c => c.count > 0);
            if(actives.length === 0) return;
            let totalTwd = 0, totalJpy = 0;
            let text = "ç›¸å¡å ±åƒ¹å¦‚ä¸‹\n------------------\n";
            actives.forEach(c => {
                let sub = c.twd * c.count;
                text += `â–«ï¸ ${c.name} Ã— ${c.count} = $${sub}\n`;
                totalTwd += sub;
                totalJpy += (c.jpy * c.count);
            });
            const finalTwd = Math.ceil(totalTwd / 5) * 5;
            const profit = Math.floor(finalTwd - (totalJpy * settings.realRate));
            text += `------------------\nç¸½è¨ˆé‡‘é¡ï¼šNT$ ${finalTwd}\n(æ­¤é‡‘é¡ä¸å«é‹è²»)`;
            document.getElementById('report-text').value = text;
            document.getElementById('card-profit').innerText = "é ä¼°åˆ©æ½¤ï¼š+" + profit;
            document.getElementById('report-box').style.display = 'block';
        }

        function calcProduct() {
            const jpy = parseFloat(document.getElementById('jpy-input').value) || 0;
            const types = [
                {t:"äºŒæ‰‹å•†å“", p:settings.pct1},
                {t:"é€šè²©ä»£è³¼", p:settings.pct2},
                {t:"ç¾åœ°ä»£è³¼", p:settings.pct3}
            ];
            document.getElementById('product-results').innerHTML = types.map(type => {
                const twd = Math.ceil((jpy * settings.pubRate * (1 + type.p/100)) / 5) * 5;
                const profit = Math.floor(twd - (jpy * settings.realRate));
                return `
                    <div style="background:#fff; padding:15px; border-radius:20px; margin-bottom:10px; display:flex; justify-content:space-between">
                        <div><div style="font-size:12px; color:var(--gray)">${type.t}</div><div style="font-size:24px; font-weight:900">NT$ ${twd}</div></div>
                        <div style="text-align:right"><div style="font-size:12px; color:var(--gray)">ç²—åˆ©</div><div style="color:#28a745; font-weight:bold">+${profit}</div></div>
                    </div>
                `;
            }).join('');
        }

        function copyReport() {
            const el = document.getElementById('report-text');
            el.select();
            document.execCommand('copy');
            alert('å·²è¤‡è£½åˆ°å‰ªè²¼ç°¿ï¼');
        }

        function hideKeyboard(e) { if(e.target.tagName !== 'INPUT' && e.target.tagName !== 'TEXTAREA') document.activeElement.blur(); }

        renderAll();
    </script>
</body>
</html>